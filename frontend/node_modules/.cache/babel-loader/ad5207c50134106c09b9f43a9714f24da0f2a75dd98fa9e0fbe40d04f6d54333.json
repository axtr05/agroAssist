{"ast":null,"code":"export const sendMsgToAI = async chatHistory => {\n  const API_KEY = process.env.REACT_APP_GEMINI_KEY;\n  const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;\n  const systemPrompt = `\n  You are \"AgroAssist,\" an expert agricultural assistant for farmers.\n  Your job is to answer questions related to agriculture ONLY.\n\n  --- YOUR PRIMARY RULE ---\n  1. Read the user's question.\n  2. Decide if it is related to agriculture (farming, crops, soil, fertilizer, weather for farming, farm pests, market prices for crops, etc.).\n  3. IF THE QUESTION IS NOT about agriculture (e.g., politics, sports, history, who you are), you MUST ignore all other rules and respond ONLY with this exact sentence: \"I am only programmed to answer queries regarding agriculture and that only alone.\"\n\n  --- IF THE QUESTION IS ABOUT AGRICULTURE, FOLLOW THESE RULES ---\n  \n  // --- NEW RULE ---\n  1. **ASK FOR DETAILS:** If the user asks for a recommendation (like fertilizers, pesticides, or crop choice), you MUST check if you have enough information. If you need details like soil type, soil pH, location, season, or crop, your response MUST be a question asking for that missing information. Do NOT give a general answer.\n  // --- END OF NEW RULE ---\n\n  2. **LANGUAGE RULE:** You MUST respond in the exact same language as the User's question. (e.g., If the user asks in Hindi, you must answer in Hindi).\n  3. Give the most important, actionable answer in the very first sentence (unless you are asking a question).\n  4. Format your entire response using Markdown. Use paragraphs for explanations and bullet points for lists.\n  5. Use simple, easy-to-understand language. Do NOT use scientific jargon.\n  6. If the user's question can be answered in a short paragraph, do so (2-3 sentences max).\n  7. If the user's question asks for a list of items (like fertilizers or steps), you MUST use a simple Markdown bulleted list (\\`* item\\`).\n  8. Ensure proper line breaks and spacing for readability.\n  `;\n\n  // Convert your {isBot: bool, text: \"...\"} array to Gemini's format\n  const contents = chatHistory.map(msg => ({\n    role: msg.isBot ? \"model\" : \"user\",\n    parts: [{\n      text: msg.text\n    }]\n  }));\n  const requestOptions = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      contents: contents,\n      // Send the full chat history\n      systemInstruction: {\n        // Send the rules separately\n        parts: [{\n          text: systemPrompt\n        }]\n      }\n    })\n  };\n  try {\n    var _data$candidates, _data$candidates$, _data$candidates$$con, _data$candidates$$con2, _data$candidates$$con3;\n    const response = await fetch(API_URL, requestOptions);\n    if (!response.ok) {\n      var _errorData$error;\n      const errorData = await response.json();\n      console.error(\"Gemini API Error Response:\", errorData);\n      throw new Error(`API request failed with status ${response.status}: ${(errorData === null || errorData === void 0 ? void 0 : (_errorData$error = errorData.error) === null || _errorData$error === void 0 ? void 0 : _errorData$error.message) || 'Unknown error'}`);\n    }\n    const data = await response.json();\n    return (data === null || data === void 0 ? void 0 : (_data$candidates = data.candidates) === null || _data$candidates === void 0 ? void 0 : (_data$candidates$ = _data$candidates[0]) === null || _data$candidates$ === void 0 ? void 0 : (_data$candidates$$con = _data$candidates$.content) === null || _data$candidates$$con === void 0 ? void 0 : (_data$candidates$$con2 = _data$candidates$$con.parts) === null || _data$candidates$$con2 === void 0 ? void 0 : (_data$candidates$$con3 = _data$candidates$$con2[0]) === null || _data$candidates$$con3 === void 0 ? void 0 : _data$candidates$$con3.text) || \"No response text found.\";\n  } catch (error) {\n    console.error(\"Gemini API call failed:\", error);\n    return `Error connecting to Gemini API: ${error.message}`;\n  }\n};","map":{"version":3,"names":["sendMsgToAI","chatHistory","API_KEY","process","env","REACT_APP_GEMINI_KEY","API_URL","systemPrompt","contents","map","msg","role","isBot","parts","text","requestOptions","method","headers","body","JSON","stringify","systemInstruction","_data$candidates","_data$candidates$","_data$candidates$$con","_data$candidates$$con2","_data$candidates$$con3","response","fetch","ok","_errorData$error","errorData","json","console","error","Error","status","message","data","candidates","content"],"sources":["C:/Users/Akshay/Downloads/test/agroAssist/frontend/src/utils/Gemini.js"],"sourcesContent":["export const sendMsgToAI = async (chatHistory) => {\r\n  const API_KEY = process.env.REACT_APP_GEMINI_KEY;\r\n\r\n  const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;\r\n\r\n  const systemPrompt = `\r\n  You are \"AgroAssist,\" an expert agricultural assistant for farmers.\r\n  Your job is to answer questions related to agriculture ONLY.\r\n\r\n  --- YOUR PRIMARY RULE ---\r\n  1. Read the user's question.\r\n  2. Decide if it is related to agriculture (farming, crops, soil, fertilizer, weather for farming, farm pests, market prices for crops, etc.).\r\n  3. IF THE QUESTION IS NOT about agriculture (e.g., politics, sports, history, who you are), you MUST ignore all other rules and respond ONLY with this exact sentence: \"I am only programmed to answer queries regarding agriculture and that only alone.\"\r\n\r\n  --- IF THE QUESTION IS ABOUT AGRICULTURE, FOLLOW THESE RULES ---\r\n  \r\n  // --- NEW RULE ---\r\n  1. **ASK FOR DETAILS:** If the user asks for a recommendation (like fertilizers, pesticides, or crop choice), you MUST check if you have enough information. If you need details like soil type, soil pH, location, season, or crop, your response MUST be a question asking for that missing information. Do NOT give a general answer.\r\n  // --- END OF NEW RULE ---\r\n\r\n  2. **LANGUAGE RULE:** You MUST respond in the exact same language as the User's question. (e.g., If the user asks in Hindi, you must answer in Hindi).\r\n  3. Give the most important, actionable answer in the very first sentence (unless you are asking a question).\r\n  4. Format your entire response using Markdown. Use paragraphs for explanations and bullet points for lists.\r\n  5. Use simple, easy-to-understand language. Do NOT use scientific jargon.\r\n  6. If the user's question can be answered in a short paragraph, do so (2-3 sentences max).\r\n  7. If the user's question asks for a list of items (like fertilizers or steps), you MUST use a simple Markdown bulleted list (\\`* item\\`).\r\n  8. Ensure proper line breaks and spacing for readability.\r\n  `;\r\n\r\n  // Convert your {isBot: bool, text: \"...\"} array to Gemini's format\r\n  const contents = chatHistory.map(msg => ({\r\n    role: msg.isBot ? \"model\" : \"user\",\r\n    parts: [{ text: msg.text }]\r\n  }));\r\n\r\n  const requestOptions = {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({\r\n      contents: contents, // Send the full chat history\r\n      systemInstruction: { // Send the rules separately\r\n        parts: [{ text: systemPrompt }]\r\n      }\r\n    }),\r\n  };\r\n\r\n  try {\r\n    const response = await fetch(API_URL, requestOptions);\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      console.error(\"Gemini API Error Response:\", errorData);\r\n      throw new Error(`API request failed with status ${response.status}: ${errorData?.error?.message || 'Unknown error'}`);\r\n    }\r\n    const data = await response.json();\r\n\r\n    return data?.candidates?.[0]?.content?.parts?.[0]?.text || \"No response text found.\";\r\n  } catch (error) {\r\n    console.error(\"Gemini API call failed:\", error);\r\n    return `Error connecting to Gemini API: ${error.message}`;\r\n  }\r\n};"],"mappings":"AAAA,OAAO,MAAMA,WAAW,GAAG,MAAOC,WAAW,IAAK;EAChD,MAAMC,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,oBAAoB;EAEhD,MAAMC,OAAO,GAAI,gGAA+FJ,OAAQ,EAAC;EAEzH,MAAMK,YAAY,GAAI;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;EAED;EACA,MAAMC,QAAQ,GAAGP,WAAW,CAACQ,GAAG,CAACC,GAAG,KAAK;IACvCC,IAAI,EAAED,GAAG,CAACE,KAAK,GAAG,OAAO,GAAG,MAAM;IAClCC,KAAK,EAAE,CAAC;MAAEC,IAAI,EAAEJ,GAAG,CAACI;IAAK,CAAC;EAC5B,CAAC,CAAC,CAAC;EAEH,MAAMC,cAAc,GAAG;IACrBC,MAAM,EAAE,MAAM;IACdC,OAAO,EAAE;MACP,cAAc,EAAE;IAClB,CAAC;IACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;MACnBZ,QAAQ,EAAEA,QAAQ;MAAE;MACpBa,iBAAiB,EAAE;QAAE;QACnBR,KAAK,EAAE,CAAC;UAAEC,IAAI,EAAEP;QAAa,CAAC;MAChC;IACF,CAAC;EACH,CAAC;EAED,IAAI;IAAA,IAAAe,gBAAA,EAAAC,iBAAA,EAAAC,qBAAA,EAAAC,sBAAA,EAAAC,sBAAA;IACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAACtB,OAAO,EAAES,cAAc,CAAC;IACrD,IAAI,CAACY,QAAQ,CAACE,EAAE,EAAE;MAAA,IAAAC,gBAAA;MAChB,MAAMC,SAAS,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;MACvCC,OAAO,CAACC,KAAK,CAAC,4BAA4B,EAAEH,SAAS,CAAC;MACtD,MAAM,IAAII,KAAK,CAAE,kCAAiCR,QAAQ,CAACS,MAAO,KAAI,CAAAL,SAAS,aAATA,SAAS,wBAAAD,gBAAA,GAATC,SAAS,CAAEG,KAAK,cAAAJ,gBAAA,uBAAhBA,gBAAA,CAAkBO,OAAO,KAAI,eAAgB,EAAC,CAAC;IACvH;IACA,MAAMC,IAAI,GAAG,MAAMX,QAAQ,CAACK,IAAI,CAAC,CAAC;IAElC,OAAO,CAAAM,IAAI,aAAJA,IAAI,wBAAAhB,gBAAA,GAAJgB,IAAI,CAAEC,UAAU,cAAAjB,gBAAA,wBAAAC,iBAAA,GAAhBD,gBAAA,CAAmB,CAAC,CAAC,cAAAC,iBAAA,wBAAAC,qBAAA,GAArBD,iBAAA,CAAuBiB,OAAO,cAAAhB,qBAAA,wBAAAC,sBAAA,GAA9BD,qBAAA,CAAgCX,KAAK,cAAAY,sBAAA,wBAAAC,sBAAA,GAArCD,sBAAA,CAAwC,CAAC,CAAC,cAAAC,sBAAA,uBAA1CA,sBAAA,CAA4CZ,IAAI,KAAI,yBAAyB;EACtF,CAAC,CAAC,OAAOoB,KAAK,EAAE;IACdD,OAAO,CAACC,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IAC/C,OAAQ,mCAAkCA,KAAK,CAACG,OAAQ,EAAC;EAC3D;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}
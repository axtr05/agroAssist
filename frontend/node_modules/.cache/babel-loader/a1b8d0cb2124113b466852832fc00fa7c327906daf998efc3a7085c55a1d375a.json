{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Akshay\\\\Downloads\\\\test\\\\agroAssist\\\\frontend\\\\src\\\\utils\\\\Context.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useRef, useEffect, useCallback } from \"react\"; // 1. Import useCallback\nimport { sendMsgToAI } from \"./Gemini\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const ContextApp = /*#__PURE__*/createContext();\nfunction AppContext({\n  children\n}) {\n  _s();\n  const [showSlide, setShowSlide] = useState(false);\n  const [Mobile, setMobile] = useState(false);\n  const [loading, setLoading] = useState(false);\n  const [chatValue, setChatValue] = useState(\"\");\n  const [message, setMessage] = useState([]);\n  const msgEnd = useRef(null);\n  const [language, setLanguage] = useState('en-US');\n  useEffect(() => {\n    var _msgEnd$current;\n    (_msgEnd$current = msgEnd.current) === null || _msgEnd$current === void 0 ? void 0 : _msgEnd$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [message, loading]);\n\n  // --- 2. REWRITTEN handleSend FUNCTION ---\n  const handleSend = useCallback(async text => {\n    // We now accept 'text' as an argument.\n    // If no text is passed, use the one from state (for typed messages)\n    const promptText = text || chatValue;\n    if (promptText.trim() === \"\") return;\n    const userMessage = {\n      text: promptText,\n      isBot: false\n    };\n\n    // Clear the input box *only* if we used the state value\n    if (!text) {\n      setChatValue(\"\");\n    }\n    setLoading(true);\n\n    // This is the key fix: We use the functional update form of setMessage\n    // 'prev' is guaranteed to be the latest state.\n    setMessage(prev => {\n      const newHistory = [...prev, userMessage];\n\n      // Call the API from *inside* the updater to avoid race conditions\n      (async () => {\n        try {\n          const res = await sendMsgToAI(newHistory); // Send the correct, new history\n          const botMessage = {\n            text: res,\n            isBot: true\n          };\n          setMessage(prev => [...prev, botMessage]);\n        } catch (error) {\n          console.error(\"Error sending message:\", error);\n          const errorMessage = {\n            text: \"Sorry, I ran into an error. Please try again.\",\n            isBot: true\n          };\n          setMessage(prev => [...prev, errorMessage]);\n        } finally {\n          setLoading(false);\n        }\n      })();\n      return newHistory; // Return the new state for the UI\n    });\n  }, [chatValue]); // Add chatValue as a dependency\n  // --- END OF REWRITE ---\n\n  // --- 3. UPDATED handleKeyPress ---\n  const handleKeyPress = useCallback(e => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSend(); // Calls handleSend with no argument, so it uses chatValue\n    }\n  }, [handleSend]); // Add handleSend as a dependency\n\n  // --- 4. UPDATED handleQuery (for sidebar) ---\n  const handleQuery = useCallback(async e => {\n    const text = e.target.innerText;\n    if (!text) return;\n\n    // This also needs to be fixed to prevent stale state\n    setLoading(true);\n    setMessage(prev => {\n      const newHistory = [...prev, {\n        text,\n        isBot: false\n      }];\n      (async () => {\n        try {\n          const res = await sendMsgToAI(newHistory);\n          const botMessage = {\n            text: res,\n            isBot: true\n          };\n          setMessage(prev => [...prev, botMessage]);\n        } catch (error) {\n          console.error(\"Error sending query:\", error);\n          const errorMessage = {\n            text: \"Sorry, I ran into an error.\",\n            isBot: true\n          };\n          setMessage(prev => [...prev, errorMessage]);\n        } finally {\n          setLoading(false);\n        }\n      })();\n      return newHistory;\n    });\n  }, []); // No dependencies needed\n\n  const contextValue = {\n    showSlide,\n    setShowSlide,\n    Mobile,\n    setMobile,\n    loading,\n    setLoading,\n    chatValue,\n    setChatValue,\n    message,\n    setMessage,\n    msgEnd,\n    handleSend,\n    // Pass the new useCallback version\n    handleKeyPress,\n    // Pass the new useCallback version\n    handleQuery,\n    // Pass the new useCallback version\n    language,\n    setLanguage\n  };\n  return /*#__PURE__*/_jsxDEV(ContextApp.Provider, {\n    value: contextValue,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 120,\n    columnNumber: 5\n  }, this);\n}\n_s(AppContext, \"tEq6YPZ4Lky89GoRWo8HufcVcco=\");\n_c = AppContext;\nexport default AppContext;\nvar _c;\n$RefreshReg$(_c, \"AppContext\");","map":{"version":3,"names":["React","createContext","useState","useRef","useEffect","useCallback","sendMsgToAI","jsxDEV","_jsxDEV","ContextApp","AppContext","children","_s","showSlide","setShowSlide","Mobile","setMobile","loading","setLoading","chatValue","setChatValue","message","setMessage","msgEnd","language","setLanguage","_msgEnd$current","current","scrollIntoView","behavior","handleSend","text","promptText","trim","userMessage","isBot","prev","newHistory","res","botMessage","error","console","errorMessage","handleKeyPress","e","key","shiftKey","preventDefault","handleQuery","target","innerText","contextValue","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Akshay/Downloads/test/agroAssist/frontend/src/utils/Context.js"],"sourcesContent":["import React, { createContext, useState, useRef, useEffect, useCallback } from \"react\"; // 1. Import useCallback\r\nimport { sendMsgToAI } from \"./Gemini\";\r\n\r\nexport const ContextApp = createContext();\r\n\r\nfunction AppContext({ children }) {\r\n  const [showSlide, setShowSlide] = useState(false);\r\n  const [Mobile, setMobile] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [chatValue, setChatValue] = useState(\"\");\r\n  const [message, setMessage] = useState([]);\r\n  const msgEnd = useRef(null);\r\n  const [language, setLanguage] = useState('en-US');\r\n\r\n  useEffect(() => {\r\n    msgEnd.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [message, loading]);\r\n\r\n  // --- 2. REWRITTEN handleSend FUNCTION ---\r\n  const handleSend = useCallback(async (text) => {\r\n    // We now accept 'text' as an argument.\r\n    // If no text is passed, use the one from state (for typed messages)\r\n    const promptText = text || chatValue;\r\n    if (promptText.trim() === \"\") return;\r\n\r\n    const userMessage = { text: promptText, isBot: false };\r\n    \r\n    // Clear the input box *only* if we used the state value\r\n    if (!text) {\r\n      setChatValue(\"\"); \r\n    }\r\n    \r\n    setLoading(true);\r\n\r\n    // This is the key fix: We use the functional update form of setMessage\r\n    // 'prev' is guaranteed to be the latest state.\r\n    setMessage((prev) => {\r\n      const newHistory = [...prev, userMessage];\r\n      \r\n      // Call the API from *inside* the updater to avoid race conditions\r\n      (async () => {\r\n        try {\r\n          const res = await sendMsgToAI(newHistory); // Send the correct, new history\r\n          const botMessage = { text: res, isBot: true };\r\n          setMessage((prev) => [...prev, botMessage]); \r\n        } catch (error) {\r\n          console.error(\"Error sending message:\", error);\r\n          const errorMessage = {\r\n            text: \"Sorry, I ran into an error. Please try again.\",\r\n            isBot: true,\r\n          };\r\n          setMessage((prev) => [...prev, errorMessage]);\r\n        } finally {\r\n          setLoading(false); \r\n        }\r\n      })();\r\n      \r\n      return newHistory; // Return the new state for the UI\r\n    });\r\n\r\n  }, [chatValue]); // Add chatValue as a dependency\r\n  // --- END OF REWRITE ---\r\n\r\n  // --- 3. UPDATED handleKeyPress ---\r\n  const handleKeyPress = useCallback((e) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault(); \r\n      handleSend(); // Calls handleSend with no argument, so it uses chatValue\r\n    }\r\n  }, [handleSend]); // Add handleSend as a dependency\r\n  \r\n  // --- 4. UPDATED handleQuery (for sidebar) ---\r\n  const handleQuery = useCallback(async (e) => {\r\n    const text = e.target.innerText;\r\n    if (!text) return;\r\n\r\n    // This also needs to be fixed to prevent stale state\r\n    setLoading(true);\r\n    setMessage((prev) => {\r\n      const newHistory = [...prev, { text, isBot: false }];\r\n\r\n      (async () => {\r\n        try {\r\n          const res = await sendMsgToAI(newHistory);\r\n          const botMessage = { text: res, isBot: true };\r\n          setMessage((prev) => [...prev, botMessage]);\r\n        } catch (error) {\r\n          console.error(\"Error sending query:\", error);\r\n          const errorMessage = { text: \"Sorry, I ran into an error.\", isBot: true };\r\n          setMessage((prev) => [...prev, errorMessage]);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      })();\r\n      \r\n      return newHistory;\r\n    });\r\n  }, []); // No dependencies needed\r\n\r\n  const contextValue = {\r\n    showSlide,\r\n    setShowSlide,\r\n    Mobile,\r\n    setMobile,\r\n    loading,\r\n    setLoading,\r\n    chatValue,\r\n    setChatValue,\r\n    message,\r\n    setMessage,\r\n    msgEnd,\r\n    handleSend,     // Pass the new useCallback version\r\n    handleKeyPress, // Pass the new useCallback version\r\n    handleQuery,    // Pass the new useCallback version\r\n    language,\r\n    setLanguage,\r\n  };\r\n\r\n  return (\r\n    <ContextApp.Provider value={contextValue}>{children}</ContextApp.Provider>\r\n  );\r\n}\r\n\r\nexport default AppContext;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}